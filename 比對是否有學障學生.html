<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­¸ç”Ÿåå–®æ¯”å°å·¥å…·</title>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; padding: 40px; background-color: #f4f7f6; color: #333; }
        .container { max-width: 800px; margin: auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        .upload-section { display: flex; flex-direction: column; gap: 20px; margin: 30px 0; }
        .file-input { border: 2px dashed #bdc3c7; padding: 20px; border-radius: 8px; text-align: center; transition: 0.3s; }
        .file-input:hover { border-color: #3498db; background: #f0f8ff; }
        label { font-weight: bold; display: block; margin-bottom: 10px; }
        button { background-color: #3498db; color: white; border: none; padding: 12px 25px; border-radius: 5px; cursor: pointer; font-size: 16px; width: 100%; transition: 0.3s; }
        button:hover { background-color: #2980b9; }
        #resultArea { margin-top: 30px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #f8f9fa; color: #2c3e50; }
        tr:nth-child(even) { background-color: #f2f2f2; }
        .count { font-size: 1.2em; font-weight: bold; color: #e74c3c; margin-bottom: 10px; }
        .hint { font-size: 0.9em; color: #7f8c8d; margin-top: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ“ å­¸ç”Ÿåå–®æ¯”å°å·¥å…·</h2>
    <p>è«‹ä¸Šå‚³ä»¥ä¸‹å…©å€‹ Excel æª”æ¡ˆï¼Œç³»çµ±æœƒæ‰¾å‡ºé‡ç–Šçš„å­¸ç”Ÿåå–®ã€‚</p>
    <p class="hint">âš ï¸ æ³¨æ„ï¼šExcel ä¸­çš„æ¬„ä½åç¨±å¿…é ˆåŒ…å«<strong>ã€Œå§“åã€</strong>å…©å­—ã€‚</p>

    <div class="upload-section">
        <div class="file-input">
            <label>1. åŸå§‹å­¸ç”Ÿåå–®æª”æ¡ˆï¼š</label>
            <input type="file" id="fileOriginal" accept=".xlsx, .xls">
        </div>
        <div class="file-input">
            <label>2. å­¸ç¿’éšœç¤™å­¸ç”Ÿåå–®æª”æ¡ˆï¼š</label>
            <input type="file" id="fileSpecial" accept=".xlsx, .xls">
        </div>
        <button onclick="compareLists()">é–‹å§‹é€²è¡Œæ¯”å°</button>
    </div>

    <div id="resultArea"></div>
</div>

<script>
    async function readExcel(file) {
        return new Promise((resolve) => {
            const reader = new FileReader();
            reader.onload = (e) => {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];
                const json = XLSX.utils.sheet_to_json(worksheet);
                resolve(json);
            };
            reader.readAsArrayBuffer(file);
        });
    }

    function findNameKey(obj) {
        // è‡ªå‹•å°‹æ‰¾åŒ…å« "å§“å" æˆ– "å­¸ç”Ÿå§“å" çš„æ¬„ä½åç¨±
        return Object.keys(obj).find(key => key.includes("å§“å"));
    }

    async function compareLists() {
        const fileA = document.getElementById('fileOriginal').files[0];
        const fileB = document.getElementById('fileSpecial').files[0];

        if (!fileA || !fileB) {
            alert("è«‹ç¢ºä¿å…©å€‹æª”æ¡ˆéƒ½å·²é¸æ“‡ï¼");
            return;
        }

        const dataA = await readExcel(fileA);
        const dataB = await readExcel(fileB);

        if (dataA.length === 0 || dataB.length === 0) {
            alert("æª”æ¡ˆä¸­æ²’æœ‰è³‡æ–™ï¼Œæˆ–æ ¼å¼ä¸æ­£ç¢ºã€‚");
            return;
        }

        // å–å¾—å§“åçš„æ¬„ä½åç¨±
        const nameKeyA = findNameKey(dataA[0]);
        const nameKeyB = findNameKey(dataB[0]);

        if (!nameKeyA || !nameKeyB) {
            alert("åœ¨ Excel ä¸­æ‰¾ä¸åˆ°åç‚ºã€Œå§“åã€çš„æ¬„ä½ï¼Œè«‹æª¢æŸ¥æª”æ¡ˆã€‚");
            return;
        }

        // æå–åå–® (å»é™¤ç©ºç™½)
        const namesB = new Set(dataB.map(item => String(item[nameKeyB]).trim()));
        
        // é€²è¡Œæ¯”å°
        const duplicates = dataA.filter(item => namesB.has(String(item[nameKeyA]).trim()));

        displayResults(duplicates, nameKeyA);
    }

    function displayResults(results, nameKey) {
        const area = document.getElementById('resultArea');
        if (results.length === 0) {
            area.innerHTML = "<p style='color:green;'>âœ… æ¯”å°å®Œæˆï¼šåŸå§‹åå–®ä¸­æ²’æœ‰ç™¼ç¾é‡è¤‡çš„å­¸ç¿’éšœç¤™å­¸ç”Ÿã€‚</p>";
            return;
        }

        let html = `<div class="count">ç™¼ç¾ ${results.length} ä½ç¬¦åˆæ¢ä»¶çš„å­¸ç”Ÿï¼š</div>`;
        html += `<table><thead><tr><th>åºè™Ÿ</th><th>å­¸ç”Ÿå§“å</th></tr></thead><tbody>`;
        
        results.forEach((student, index) => {
            html += `<tr><td>${index + 1}</td><td>${student[nameKey]}</td></tr>`;
        });

        html += `</tbody></table>`;
        area.innerHTML = html;
    }
</script>

</body>
</html>
